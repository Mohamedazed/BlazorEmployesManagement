@using System.Security.Claims
@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider

<div class="top-row ps-3 navbar navbar-dark w-100">
    <div class="container-fluid d-flex justify-content-between ">
        <div>
            <a class="navbar-brand" href="">Crud1</a>
            <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        
        <div class="d-flex">
            <div class="d-flex me-5 mt-3 gap-3">
                @if (LoginDisplay != null)
                {
                    @LoginDisplay
                }
            </div>
            <RadzenProfileMenu>
                <Template>
                    <RadzenImage Src="fotografia.png" Style="width: 40px; height: 40px; border-radius: 50%;" />
                </Template>
                <ChildContent>
                    <p class="mt-3 mx-3">@user?.Identity?.Name</p>
                    <hr />
                    <RadzenProfileMenuItem Text="Profile" Path="/profile" Icon="account_circle"></RadzenProfileMenuItem>
                    <RadzenProfileMenuItem Text="Employee" Path="Employees" Icon="line_weight"></RadzenProfileMenuItem>
                    <RadzenProfileMenuItem Text="Setting" Path="/" Icon="attach_file"></RadzenProfileMenuItem>
                </ChildContent>
            </RadzenProfileMenu>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public RenderFragment? LoginDisplay { get; set; }

    private bool collapseNavMenu = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private ClaimsPrincipal user;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        user = authState.User;
    }
}
